# Currency Wallet API

Сервис для управления мультивалютным кошельком, предоставляющий API для просмотра баланса, пополнения, списания и обмена валют.

## Технологический стек

- **Язык**: Go
- **База данных**: PostgreSQL
- **Кэширование**: Redis
- **Брокер сообщений**: Apache Kafka + Zookeeper
- **Мониторинг и метрики**: Prometheus + Grafana
- **Профилирование**: Pyroscope
- **Миграции**: goose
- **API Документация**: swag

## Архитектура

Проект построен на основе слоистой архитектуры и принципов чистой архитектуры. Основная логика разделена на слои:

- `internal/feature`: Бизнес-логика, разделенная по функциональным модулям (пользователи, кошельки).
- `internal/app`: Слой приложения, который связывает хендлеры, сервисы и репозитории.
- `internal/domain`: Основные доменные модели и константы.
- `pkg`: Переиспользуемые пакеты (подключение к БД, логгер, http-сервер).
- `cmd/main`: Точка входа в приложение.

Сервис использует паттерн **Outbox** для надежной доставки событий в Kafka.

## Запуск проекта

Для запуска проекта используется Docker. Убедитесь, что у вас установлен Docker и Docker Compose.

1.  **Склонируйте репозиторий:**

    ```bash
    git clone <URL репозитория>
    cd currency-wallet
    ```

2.  **Запустите все сервисы:**

    Для запуска всех необходимых сервисов (PostgreSQL, Redis, Kafka и т.д.) выполните команду:

    ```bash
    make docker
    ```

    Эта команда запустит все контейнеры, описанные в `docker-compose.yaml`, в фоновом режиме.

3.  **Запустите приложение:**

    Для сборки и запуска основного приложения выполните:

    ```bash
    make run
    ```

    Приложение будет доступно по адресу `http://localhost:8080` (или на порту, указанном в конфигурации).

## Миграции

В проекте используются миграции для управления схемой базы данных с помощью `goose`.

- **Накатить миграции:**

  ```bash
  make migrations-up
  ```

- **Откатить последнюю миграцию:**

  ```bash
  make migrations-down
  ```

- **Создать новый файл миграции:**
  ```bash
  make migrations-new MIGRATION_NAME=my_new_migration
  ```

## API Документация

В проекте используется Swagger для документирования API.

1.  **Генерация документации:**
    Для генерации или обновления документации выполните:

    ```bash
    make swag
    ```

    Эта команда обновит файлы в директории `docs/`.

2.  **Просмотр документации:**
    После запуска приложения документация Swagger UI будет доступна по адресу:
    `http://localhost:8080/swagger/index.html`

## Дополнительные команды

- `make build`: Собрать бинарный файл приложения.
- `make docker-app`: Собрать docker-образ и запустить все сервисы, включая приложение.
- `make compose-prod`: Запустить проект с использованием `docker-compose.prod.yaml` для продакшн-окружения.
